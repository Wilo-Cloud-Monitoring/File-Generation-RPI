# Automating GitHub Deployment and Service Execution on Raspberry Pi

This guide provides step-by-step instructions for automating the process of generating SSH deploy keys, configuring them for GitHub access, and setting up a systemd service to pull the latest code and run your Python application automatically on a Raspberry Pi.

## Files
- **`configure_deploy_keys.sh`**: A shell script to generate SSH deploy keys and display the public key, which you will add to your GitHub repository.
- **`wilo.service`**: A systemd service file that automatically pulls the latest code from your GitHub repository and runs a Python script on boot.

---

## Prerequisites

1. Raspberry Pi running a Linux-based OS.
2. Git installed on your Raspberry Pi:
   ```bash
   sudo apt-get update
   sudo apt-get install git
   ```
3. Python 3 installed:
   ```bash
   sudo apt-get install python3
   ```

---

## Step 1: Configure SSH Deploy Keys

### 1.1 Generate Deploy Keys

1. Copy the `configure_deploy_keys.sh` script to your Raspberry Pi.

2. Make the script executable:
   ```bash
   chmod +x configure_deploy_keys.sh
   ```

3. Run the script to generate a new SSH deploy key:
   ```bash
   ./configure_deploy_keys.sh
   ```

   The script will check if an SSH key already exists. If not, it will generate a new RSA 4096-bit SSH key pair and display the public key.

4. Copy the public key from the script output.

### 1.2 Add the Public Key to GitHub

1. Go to your private GitHub repository.
2. Navigate to **Settings** > **Deploy Keys**.
3. Click **Add deploy key**.
4. Paste the public key that was generated by the script.
5. Give the key a meaningful name (e.g., `Raspberry Pi Deploy Key`).
6. Ensure the **Allow write access** option is unchecked, and click **Add key**.

---

## Step 2: Set Up the Systemd Service

### 2.1 Copy the Service File

1. Copy the `wilo.service` file to the `/etc/systemd/system/` directory on your Raspberry Pi:
   ```bash
   sudo cp wilo.service /etc/systemd/system/
   ```

2. Ensure the `ExecStart` path in `wilo.service` is correct. The service file should point to your project folder and the Python script.

### 2.2 Modify the Service File

Open the `wilo.service` file to update it with the correct paths:

```bash
sudo nano /etc/systemd/system/wilo.service
```

### 2.3 Enable the Service

Enable the service so it runs on boot:

```bash
sudo systemctl enable wilo.service
```

Start the service immediately:

```bash
sudo systemctl start wilo.service
```

Check the status of the service to ensure it is running:

```bash
sudo systemctl status wilo.service
```

---

## Step 3: Testing the Setup

1. **Reboot your Raspberry Pi** to ensure that the service works on boot:
   ```bash
   sudo reboot
   ```

2. After rebooting, check that the service is running and pulling the latest changes from the GitHub repository:
   ```bash
   sudo systemctl status wilo.service
   ```

3. The Python script will run automatically after pulling the latest changes from the repository.

---

## File Details

### `configure_deploy_keys.sh`
This script automates the creation of an SSH deploy key pair. It checks if the keys exist, generates them if not, and displays the public key, which you can add as a deploy key in GitHub.

### `wilo.service`
A systemd service file that:
- Navigates to the project directory on your Raspberry Pi.
- Pulls the latest code from the GitHub repository using the deploy key.
- Runs a specified Python script.
- Restarts automatically if the process fails.

---

## Troubleshooting

- **Check SSH key permissions**: Ensure the SSH private key has the correct permissions:
   ```bash
   chmod 600 ~/.ssh/id_rsa
   ```
  
- **Verify GitHub access**: Test SSH access to GitHub manually:
   ```bash
   ssh -T git@github.com
   ```

- **Service not running**: Check the logs of the service using:
   ```bash
   sudo journalctl -u wilo.service
   ```

---

## Conclusion

By following these steps, youâ€™ve successfully automated the deployment of a Python script on a Raspberry Pi that pulls the latest code from a private GitHub repository and runs on boot using systemd and SSH deploy keys.
